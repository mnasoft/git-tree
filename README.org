#+options: ':nil *:t -:t ::t <:t H:3 \n:nil ^:t arch:headline
#+options: author:t broken-links:nil c:nil creator:nil
#+options: d:(not "LOGBOOK") date:t e:t email:nil f:t inline:t num:t
#+options: p:nil pri:nil prop:nil stat:t tags:t tasks:t tex:t
#+options: timestamp:t title:t toc:t todo:t |:t
#+title: README
#+date: <2021-05-02 Вс>
#+author:
#+email: mnasoft@gmail.com
#+language: en
#+select_tags: export
#+exclude_tags: noexport
#+creator: Emacs 27.2 (Org mode 9.4.4)
#+options: html-link-use-abs-url:nil html-postamble:auto
#+options: html-preamble:t html-scripts:t html-style:t
#+options: html5-fancy:nil tex:t
#+html_doctype: xhtml-strict
#+html_container: div
#+description:
#+keywords:
#+html_link_home:
#+html_link_up:
#+html_mathjax:
#+html_equation_reference_format: \eqref{%s}
#+html_head:
#+html_head_extra:
#+subtitle:
#+infojs_opt:
#+creator: <a href="https://www.gnu.org/software/emacs/">Emacs</a> 27.2 (<a href="https://orgmode.org">Org</a> mode 9.4.4)
#+latex_header:

* Назначение
 Пакет предназначен для выполнения однотипных операций на дереве
 каталогов, содержащем репозитории git.
* Установка
#+begin_src shell
   sudo ./INSTALL.run
#+end_src
* Удаление
#+begin_src shell
   sudo ./UNINSTALL.run 
#+end_src

- INSTALL.log - лог установки
- INSTALL.run - сценарий установки
- README.org - настоящий документ
- ToDo.org  - заметки по направлению развития проекта
- UNINSTALL.run - сценарий удаления

- clp-config - содержит системные переменные и функции;
- clp-xz-pp-public - создает в каталоге ${PUB_HTML_CLP_ARH}/ xz.tar;
- clp-xz-pz-public - создает в каталоге ${PUB_HTML_CLP_ARH}/ xz-big.tar;
- git-reclone - удаление каталога, содержащего репозиторий pi и
  повторное его клонирование из удаленного репозитория
- git-tree - работа с деревом репозиториев
- git-tree-repo
- rs-emacs-d - Перенос в каталог ${PUB_HTML_CLP_ARH}/ файлов из
  каталога [[~/.emacs.d]].

- remake-git-pp - Выполняет пересоздание каталога ~/git, наполняя его
  чистыми репозиториями. Поиск репозиротиев ведется в каталогах:
  ~/quicklisp/local-projects/; ~/develop/; ~/elisp/.

- fgt_remake_xz_pp_all - Создает архивы git.tar.xz для мест
  расположения чистых репозиториев pp и pz
- rs-pacman - Выполняет перенос в папку ~/public_html/ пакетов и
  файлов синхронизации, необходимях для обновления msys2.
- rs-quicklisp - Выполняет перенос в каталог ~/public_html/ файлов,
  необходимях для обновления quicklisp.

- clp-xz-pi - Выполняет перенос на сайт pi ${PUB_HTML_CLP_ARH}/
  архивов git.tar.xz.
- rs-local-pi - Синхронизация папки ~/public_html/ с с сервером
  mnasoft.ddns.mksat.net.
- rs-pi-html - Синхронизация папки ~/public_html/Common-Lisp-Programs/
  с сервером mnasoft.ddns.mksat.net
- rs-pi-local - Синхронизация mnasoft.ddns.mksat.net с папкой
  ~/public_html.
- xz-git - Распаковывает архивы git.tar.xz, содержащие репозитории
  git, в каталоги с чистыми репозиториями для pp и pz расположений.

* Команды
  1. Установка / Удаление
     + INSTALL.run - содержит команды установки комплекса скриптов в
       системе;
     + UNINSTALL.run - содержит команды деинталляции комплекса скриптов в
       системе;
     + INSTALL.log - содержит перечень файлов, установленных
       комплексом шрифтов в системе;
  2. Выполнение операций git на дереве коталогов
     + git-tree-repo - выполняет команду для каждого репозитория git,
       найденного в дереве каталогов, для конкретного удаленного
       репозитория.
     + git-tree - выполняет команду для каждого репозитория git,
       найденного в дереве каталогов, для всех удаленных репозиторев.
  3. Повторное клонированние с удалением
     + git-reclone - для каталога, содержащего git-репозиторий
       выполняет:
       - проверку того, что в git-репозитории существует ссылка на
         удаленный git-репозиторий;
       - в случае успеха переходит вышележащий каталог, удаляет
         git-репозиторий и затем осуществляет попытку его повторного
         клонирования.
  4. PI
     + rs-local-pi - выполняет синхронизацию папки
       ~/public_html/Common-Lisp-Programs с удаленным компьютером pi.
     + rs-pi-local - выполняет синхронизацию удаленного компьютера pi
       с папкой ~/public_html/Common-Lisp-Programs
  5. n000325
     + clp-n000325-remake-git
     + clp-n000325-remake-xz

* Примеры использования
1. Перейдите в каталог, в котором содержатся репозитории git.
2. Выполните команду
#+begin_src shell
 git-tree
#+end_src

* Граф вызовов
  #+name:dot-eg-table
  | check_dir_git         | make_repo_vars                 |
  | check_dir_xz          | make_repo_vars                 |
  | rm_git                | make_repo_vars                 |
  | remove_xz             | make_repo_vars                 |
  | make_git              | make_repo_vars                 |
  | remake_xz             | remove_xz                      |
  | remake_xz             | check_dir_xz                   |
  | remake_xz             | make_repo_vars                 |
  | remake_git            | rm_git                         |
  | remake_git            | make_git                       |
  | remake_tar_xz         | check_dir_public_html_clp_arch |
  | remake_tar_xz         | remake_xz                      |
  | remake_tar_xz         | make_repo_vars                 |
  | fgt_push              | echo_short                     |
  | fgt_pull              | echo_short                     |
  | fgt_add               | echo_short                     |
  | fgt_readd             | echo_short                     |
  | fgt_readd             | make_repo_vars                 |
  | fgt_git_rm           | echo_short                     |
  | fgt_git_rm           | make_repo_vars                 |
  | fgt_git_clone        | make_repo_vars                 |
  | fgt_git_clone        | echo_short                     |
  | fgt_commit            | echo_short                     |
  | fgt_push_or_pull      | echo_short                     |
  | fgt_command_branch    | fgt_current_branch             |
  | fgt_command_branch    | fgt_push_or_pull               |
  | fgt_command_branch    | fgt_pull                       |
  | fgt_command_branch    | fgt_push                       |
  | fgt_command_branch    | fgt_add                        |
  | fgt_command_branch    | fgt_commit                     |
  | fgt_command_branch    | fgt_pull                       |
  | fgt_command_branch    | fgt_add                        |
  | fgt_command_branch    | fgt_commit                     |
  | fgt_command_branch    | fgt_push                       |
  | fgt_command_branch    | fgt_readd                      |
  | fgt_command_branch    | fgt_git_rm                    |
  | fgt_command_branch    | fgt_git_clone                 |
  | fgt_command           | echo_long_equal                |
  | fgt_command           | echo_long                      |
  | fgt_command           | fgt_command_branch             |
  | fgt_command           | echo_long_plus                 |
  | rs_quicklisp          | check_dir_public_html_clp_arch |
  | rs_pacman             | check_dir_public_html_clp_arch |
  | rs_dot_emacs_d_public | check_dir_public_html_clp_arch |
  | cd_git_url            | make_repo_vars                 |
  | xz_git                | check_dir_git                  |
  | xz_git                | cd_git_url                     |
  | xz_git                | make_repo_vars                 |
  | fgt_usage_location    | fgt_usage_show                 |
  | fgt                   | fgt_usage_show                 |
  | fgt                   | fgt_usage_location             |
  | fgt                   | fgt_command                    |
  | fgt                   | remake_xz                      |
  | fgt                   | remake_tar_xz                  |
  | fgt                   | xz_git                         |
  | fgt                   | remake_git                     |
  | fgt                   | make_git                       |
  | fgt                   | rs_quicklisp                   |
  | fgt                   | rs_pacman                      |
  | fgt                   | rs_dot_emacs_d_public          |
  | fgt                   | fgt_reclone                   |
  | fgt                   | add_aliases                    |
  | fgt                   | fgt_usage_show                 |

  #+name: make-dot
  #+begin_src lisp :var table=dot-eg-table :results output :exports none

    (format t "rankdir=LR;~%")
    (mapcar
     #'(lambda (x)
         (format t "~s [label =~s, shape = \"box\"];~%" x x ))
     (remove-duplicates (apply #'append table)))

    (format t "~{~{~S~^ -> ~};~%~}" table)
  #+end_src

  #+RESULTS: make-dot
  #+begin_example
  rankdir=LR;
  "check_dir_git" [label ="check_dir_git", shape = "box"];
  "make_repo_vars" [label ="make_repo_vars", shape = "box"];
  "check_dir_xz" [label ="check_dir_xz", shape = "box"];
  "make_repo_vars" [label ="make_repo_vars", shape = "box"];
  "rm_git" [label ="rm_git", shape = "box"];
  "make_repo_vars" [label ="make_repo_vars", shape = "box"];
  "remove_xz" [label ="remove_xz", shape = "box"];
  "make_repo_vars" [label ="make_repo_vars", shape = "box"];
  "make_git" [label ="make_git", shape = "box"];
  "make_repo_vars" [label ="make_repo_vars", shape = "box"];
  "check_dir_git" -> "make_repo_vars";
  "check_dir_xz" -> "make_repo_vars";
  "rm_git" -> "make_repo_vars";
  "remove_xz" -> "make_repo_vars";
  "make_git" -> "make_repo_vars";
  #+end_example

  #+begin_src dot :file ./test-dot.png :var input=make-dot :exports results
    digraph
    {
    $input
    }
    #+end_src

    #+RESULTS:
    [[file:./test-dot.png]]
