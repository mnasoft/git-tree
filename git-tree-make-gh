#!/bin/bash

# . /etc/git-tree/git-tree.conf

# ๐ ะคัะฝะบัะธั ัะฟัะฐะฒะบะธ
usage() {
    echo -e "\n๐งฐ USAGE: $0 [--public | --private] [--help]"
    
    echo -e "\n๐ ะะฟะธัะฐะฝะธะต:"
    echo "  ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะทะดะฐัั ะฝะพะฒัะน ัะตะฟะพะทะธัะพัะธะน ะฝะฐ GitHub"
    echo "  ั ะธะผะตะฝะตะผ, ัะพะฒะฟะฐะดะฐััะธะผ ั ะธะผะตะฝะตะผ ะบะพัะฝะตะฒะพะณะพ ะบะฐัะฐะปะพะณะฐ ัะตะบััะตะณะพ Git-ะฟัะพะตะบัะฐ,"
    echo "  ะธ ะทะฐะณััะถะฐะตั ะฒ ะฝะตะณะพ ัะพะดะตัะถะธะผะพะต."
    echo "  ะัะฟะพะปัะทัะตััั GitHub CLI (gh), ะฟะพััะพะผั ััะตะฑัะตััั ะฐะฒัะพัะธะทะฐัะธั ัะตัะตะท 'gh auth login'."

    echo -e "\n๐ ะะฐัะฐะผะตััั:"
    echo "  --public    โ ัะพะทะดะฐัั ะฟัะฑะปะธัะฝัะน ัะตะฟะพะทะธัะพัะธะน (ะฟะพ ัะผะพะปัะฐะฝะธั)"
    echo "  --private   โ ัะพะทะดะฐัั ะฟัะธะฒะฐัะฝัะน ัะตะฟะพะทะธัะพัะธะน"
    echo "  --help      โ ะฟะพะบะฐะทะฐัั ััะพ ัะพะพะฑัะตะฝะธะต"

    echo -e "\n๐ ะัะธะผะตัั:"
    echo "  $0 --public"
    echo "  $0 --private"
}

# ๐ ะัะปะธ ะฝะตั ะฟะฐัะฐะผะตััะพะฒ ะธะปะธ ัะบะฐะทะฐะฝ --help โ ะฟะพะบะฐะทะฐัั ัะฟัะฐะฒะบั
if [[ $# -eq 0 || "$1" == "--help" ]]; then
    usage
    exit 0
fi

# ๐ ะะฟัะธะธ
VISIBILITY="--public"

while [[ $# -gt 0 ]]; do
    case "$1" in
        --public)
            VISIBILITY="--public"
            shift
            ;;
        --private)
            VISIBILITY="--private"
            shift
            ;;
        --help)
            usage
            exit 0
            ;;
        *)
            echo "โ ะะตะธะทะฒะตััะฝัะน ะฟะฐัะฐะผะตัั: $1"
            usage
            exit 1
            ;;
    esac
done

# ๐ ะะตัะตัะพะด ะฒ ะบะพัะตะฝั ัะตะฟะพะทะธัะพัะธั
if ! ROOT_DIR=$(git rev-parse --show-toplevel 2>/dev/null); then
    echo "โ ะขะตะบััะธะน ะบะฐัะฐะปะพะณ ะฝะต ัะฒะปัะตััั Git-ัะตะฟะพะทะธัะพัะธะตะผ"
    exit 1
fi
cd "$ROOT_DIR" || exit 1

# ๐ ะะฟัะตะดะตะปะตะฝะธะต ะธะผะตะฝะธ ัะตะฟะพะทะธัะพัะธั
RNAME=$(basename "$ROOT_DIR")
echo "๐ ะะผั ัะตะฟะพะทะธัะพัะธั: $RNAME"
echo "๐ ะะพัะตะฝั ะฟัะพะตะบัะฐ: $ROOT_DIR"

# ๐ ะกะพะทะดะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั ะฝะฐ GitHub
gh repo create "$RNAME" "$VISIBILITY" --source=. --remote=gh

# ๐ ะะฐะณััะทะบะฐ ัะพะดะตัะถะธะผะพะณะพ
git push -u gh master
